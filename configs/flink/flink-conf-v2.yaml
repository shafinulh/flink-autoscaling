################################################################################
#  Licensed to the Apache Software Foundation (ASF) under one
#  or more contributor license agreements.  See the NOTICE file
#  distributed with this work for additional information
#  regarding copyright ownership.  The ASF licenses this file
#  to you under the Apache License, Version 2.0 (the
#  "License"); you may not use this file except in compliance
#  with the License.  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
# limitations under the License.
################################################################################

cluster.evenly-spread-out-slots: true

taskmanager.memory.process.size: 3g
taskmanager.cpu.cores: 4
taskmanager.numberOfTaskSlots: 4
parallelism.default: 1

jobmanager.rpc.address: 142.150.234.180
jobmanager.rpc.port: 6123
jobmanager.memory.process.size: 8G
io.tmp.dirs: /tmp

rest.profiling.enabled: true

#==============================================================================
# JVM
#==============================================================================

# JVM options for GC
# env.java.opts: -verbose:gc -XX:NewRatio=3 -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:ParallelGCThreads=4
# env.java.opts.jobmanager: -Xloggc:$FLINK_LOG_DIR/jobmanager-gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=2 -XX:GCLogFileSize=512M
# env.java.opts.taskmanager: -Xloggc:$FLINK_LOG_DIR/taskmanager-gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=2 -XX:GCLogFileSize=512M
env.java.opts: --add-opens java.base/java.util=ALL-UNNAMED --add-opens java.base/java.time=ALL-UNNAMED -XX:NewRatio=3 -Xlog:gc*:time,uptime,level -XX:ParallelGCThreads=4
env.java.opts.jobmanager: -Xlog:gc*:file=${FLINK_LOG_DIR}/jobmanager-gc.log:time,uptime,level
env.java.opts.taskmanager: -Xlog:gc*:file=${FLINK_LOG_DIR}/taskmanager-gc.log:time,uptime,level

#==============================================================================
# State & Checkpoint
#==============================================================================

state.backend.type: rocksdb
# state.backend.rocksdb.memory.managed: true
# taskmanager.memory.managed.fraction: 0.4
# state.backend.rocksdb.memory.write-buffer-ratio: 0.5
# state.backend.rocksdb.memory.high-prio-pool-ratio: 0.1
state.backend.rocksdb.memory.managed: false
state.backend.rocksdb.options-factory: com.example.CustomRocksDBOptionsFactory
# Enable RocksDB bloom filters so negative lookups don't fan out to every SSTable.
# state.backend.rocksdb.use-bloom-filter: true
# state.backend.rocksdb.bloom-filter.bits-per-key: 10.0
# state.backend.rocksdb.bloom-filter.block-based-mode: false
# execution.checkpointing.incremental: true
# for example, hdfs://benchmark01/checkpoint
state.checkpoints.dir: file:///mnt/home/haques24/flink-state
execution.checkpointing.interval: 18000000
execution.checkpointing.savepoint-dir: file:///mnt/home/haques24/flink-state/savepoints
state.backend.rocksdb.localdir: /data/rocksdb
execution.checkpointing.incremental: true
execution.checkpointing.mode: EXACTLY_ONCE
state.backend.local-recovery: true

# #==============================================================================
# # RocksDB block cache trace
# #==============================================================================

# state.backend.rocksdb.block-cache-trace.enabled: true
# state.backend.rocksdb.block-cache-trace.dir: /data/rocksdb/block-cache-traces
# state.backend.rocksdb.block-cache-trace.max-file-size: 10gb
# state.backend.rocksdb.block-cache-trace.sync-file: false

#==============================================================================
# Runtime Others
#==============================================================================

# configuration options for adjusting and tuning table programs.
# table.exec.mini-batch.enabled: true
# table.exec.mini-batch.allow-latency: 2s
# table.exec.mini-batch.size: 50000
# table.optimizer.distinct-agg.split.enabled: true

# disable final checkpoint to avoid test waiting for the last checkpoint complete
# execution.checkpointing.checkpoints-after-tasks-finish.enabled: false

#==============================================================================
# Metrics
#==============================================================================

metrics.reporters: prom
metrics.reporter.prom.factory.class: org.apache.flink.metrics.prometheus.PrometheusReporterFactory
metrics.reporter.prom.port: 9249-9260

# Enable per-operator latency tracking so we can see state access histograms
# state.backend.latency-track.keyed-state-enabled: true
# state.backend.latency-track.sample-interval: 10
# state.backend.latency-track.history-size: 10000

# Expose RocksDB cache, memory, and compaction statistics for Prometheus/Grafana.
# memory related - rocksdb block cache
state.backend.rocksdb.metrics.block-cache-capacity: true
state.backend.rocksdb.metrics.block-cache-usage: true
state.backend.rocksdb.metrics.block-cache-pinned-usage: true

state.backend.rocksdb.metrics.block-cache-hit: true
state.backend.rocksdb.metrics.block-cache-miss: true

# memory related - memtables
state.backend.rocksdb.metrics.cur-size-active-mem-table: true
state.backend.rocksdb.metrics.cur-size-all-mem-tables: true
state.backend.rocksdb.metrics.size-all-mem-tables: true
state.backend.rocksdb.metrics.num-immutable-mem-table: true

# storage related
state.backend.rocksdb.metrics.iter-bytes-read: true
state.backend.rocksdb.metrics.bytes-read: true
state.backend.rocksdb.metrics.bytes-written: true

state.backend.rocksdb.metrics.num-files-at-level0: true
state.backend.rocksdb.metrics.num-files-at-level1: true
state.backend.rocksdb.metrics.num-files-at-level2: true
state.backend.rocksdb.metrics.num-live-versions: true
state.backend.rocksdb.metrics.total-sst-files-size: true
state.backend.rocksdb.metrics.live-sst-files-size: true

state.backend.rocksdb.metrics.estimate-num-keys: true
state.backend.rocksdb.metrics.estimate-live-data-size: true
state.backend.rocksdb.metrics.estimate-pending-compaction-bytes: true
state.backend.rocksdb.metrics.estimate-table-readers-mem: true

state.backend.rocksdb.metrics.compaction-pending: true
state.backend.rocksdb.metrics.compaction-read-bytes: true
state.backend.rocksdb.metrics.compaction-write-bytes: true
state.backend.rocksdb.metrics.column-family-as-variable: true
